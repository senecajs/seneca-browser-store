"use strict";function y(t){let e=this,o=e.export("entity/init"),u=t.handleResponse,s=["save","load","list","remove"].reduce((n,a)=>(n[a]=u[a]||u.any,n),{});const b=[];function m(n,a,d){let r={},i=d.apimsg;for(let l in i){let f=i[l];typeof f=="function"?r[l]=f(n,a,d):r[l]=JSON.parse(JSON.stringify(f))}return r}let c={name:"BrowserStore",save:function(n,a,d){let r=t.debug&&v(arguments),i=t.prepareCtx(n),l=m(n,i,t);r&&w(r,i,l),this.act(l,function(g,_,p){return r&&h(r,arguments),s.save(this,i,a,g,_,p,r)})},load:function(n,a,d){let r=t.debug&&v(arguments),i=t.prepareCtx(n),l=m(n,i,t);r&&w(r,i,l),this.act(l,function(g,_,p){return r&&h(r,arguments),s.load(this,i,a,g,_,p,r)})},list:function(n,a,d){let r=t.debug&&v(arguments),i=t.prepareCtx(n),l=m(n,i,t);r&&w(r,i,l),this.act(l,function(g,_,p){return r&&h(r,arguments),s.list(this,i,a,g,_,p,r)})},remove:function(n,a,d){let r=t.debug&&v(arguments),i=t.prepareCtx(n),l=m(n,i,t);r&&w(r,i,l),this.act(l,function(g,_,p){return r&&h(r,arguments),s.remove(this,i,a,g,_,p,r)})},close:function(n,a){a()},native:function(n,a){a()}},$=o(e,t,c);function v(n){let a=t.debug&&{msg:n[0],meta:n[2],start:Date.now()};return a&&b.push(a),a}function w(n,a,d){return n.apistart=Date.now(),n.ctx=a,n.apimsg=d,n}function h(n,a){return n.apiend=Date.now(),n.err=a[0],n.res=a[1],n.apimeta=a[2],n}return{name:c.name,tag:$.tag,exports:{makeApiMsg:m,msglog:b}}}function S(t,e){return t.entity(e.zone,e.base,e.name).canon$()}y.defaults={debug:!1,apimsg:{aim:"req",on:"entity",debounce$:!0,q:(t,e)=>t.q,ent:(t,e)=>t.ent,save:(t,e)=>e.cmd==="save"?"entity":void 0,load:(t,e)=>e.cmd==="load"?"entity":void 0,list:(t,e)=>e.cmd==="list"?"entity":void 0,remove:(t,e)=>e.cmd==="remove"?"entity":void 0,store:(t,e)=>e.store,name:(t,e)=>e.name,base:(t,e)=>e.base,zone:(t,e)=>e.zone},prepareCtx:(t,e)=>{e=e||{};let o=t.q;e.store=o.store$!==!1,delete o.store$,e.cmd=t.cmd;let u=t.ent||t.qent;if(u){if(u.canon$)Object.assign(e,u.canon$({object:!0}));else if(u.entity$){let s=u.entity$.split("/");Object.assign(e,{zone:s[0]==="-"?null:s[0],base:s[1]==="-"?null:s[1],name:s[2]==="-"?null:s[2]})}}return e},handleResponse:{any:function(t,e,o,u,s,b,m){if(m&&(m.end=Date.now()),u)return o(u);if(s&&s.ok)return o(s.ent);{let c=s&&s.err;return c=c||new Error(`BrowserStore: ${e.cmd} ${S(t,e)}: unknown error`),o(c)}},list:function(t,e,o,u,s,b,m){if(m&&(m.end=Date.now()),u&&o(u),s&&s.ok&&s.list){let c=t.entity({zone:e.zone,base:e.base,name:e.name}),$=s.list.map(v=>c.make$().data$(v));m&&(m.end=Date.now()),o($)}else{let c=s&&s.err;c=c||new Error(`BrowserStore: ${e.cmd} ${S(t,e)}: unknown list error`),o(c)}}}};Object.defineProperty(y,"name",{value:"BrowserStore"});module.exports=y;
//# sourceMappingURL=browser-store.cjs.js.map
