"use strict";function $(t){let r=this,o=r.export("entity/init"),c=t.handleResponse,s=["save","load","list","remove"].reduce((n,a)=>(n[a]=c[a]||c.any,n),{});const w=[];function u(n,a,_){let e={},i=_.apimsg;for(let l in i){let p=i[l];typeof p=="function"?e[l]=p(n,a,_):e[l]=JSON.parse(JSON.stringify(p))}return e}let m={name:"BrowserStore",save:function(n,a,_){let e=t.debug&&h(arguments),i=t.prepareCtx(n),l=u(n,i,t);e&&(e.ctx=i)&&(e.apimsg=l),this.act(l,function(d,f,g){return e&&(e.apiend=Date.now())&&(e.err=d)&&(e.res=f)&&(e.apimeta=g),s.save(this,i,a,d,f,g,e)})},load:function(n,a,_){let e=t.debug&&h(arguments),i=t.prepareCtx(n),l=u(n,i,t);e&&(e.ctx=i)&&(e.apimsg=l),this.act(l,function(d,f,g){return e&&x(e,arguments),s.load(this,i,a,d,f,g,e)})},list:function(n,a,_){let e=t.debug&&h(arguments),i=t.prepareCtx(n),l=u(n,i,t);e&&(e.ctx=i)&&(e.apimsg=l),this.act(l,function(d,f,g){return e&&x(e,arguments),s.list(this,i,a,d,f,g,e)})},remove:function(n,a,_){let e=t.debug&&h(arguments),i=t.prepareCtx(n),l=u(n,i,t);e&&(e.ctx=i)&&(e.apimsg=l),this.act(l,function(d,f,g){return e&&x(e,arguments),s.remove(this,i,a,d,f,g,e)})},close:function(n,a){a()},native:function(n,a){a()}},v=o(r,t,m);function h(n){let a=t.debug&&{msg:n[0],meta:n[2],start:Date.now()};return a&&w.push(a),a}function x(n,a){return n.apiend=Date.now(),n.err=a[0],n.res=a[1],n.apimeta=a[2],n}return{name:m.name,tag:v.tag,exports:{makeApiMsg:u,msglog:w}}}$.defaults={debug:!1,apimsg:{aim:"req",on:"entity",debounce$:!0,q:(t,r)=>t.q,ent:(t,r)=>t.ent,cmd:(t,r)=>r.cmd,canon:(t,r)=>(t.ent||t.qent).entity$,store:(t,r)=>r.store},prepareCtx:(t,r)=>{r=r||{};let o=t.q;return r.store=o.store$!==!1,delete o.store$,r.cmd=t.cmd,r.canon=(t.ent||t.qent).entity$,r},handleResponse:{any:function(t,r,o,c,s,w,u){if(console.log("BS RES",c,s),u&&(u.end=Date.now()),c&&o(c),s)if(s.ok)o(s.ent);else{let m=s.err;m=m||new Error(`BrowserStore: ${r.cmd} ${r.canon}: unknown error`),o(m)}},list:function(t,r,o,c,s,w,u){if(u&&(u.end=Date.now()),c&&o(c),s&&s.ok&&s.list){let m=s.list.map(v=>t.entity(r.canon).data$(v));u&&(u.end=Date.now()),o(m)}else o(s&&s.err||new Error(`BrowserStore: ${r.cmd} ${r.canon}: unknown list error`))}}};Object.defineProperty($,"name",{value:"BrowserStore"});module.exports=$;
//# sourceMappingURL=browser-store.cjs.js.map
