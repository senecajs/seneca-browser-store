(function(c,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(c=typeof globalThis<"u"?globalThis:c||self,c.BrowserStore=h())})(this,function(){"use strict";function c(e){let t=this,m=t.export("entity/init"),l=e.handleResponse,i=["save","load","list","remove"].reduce((n,a)=>(n[a]=l[a]||l.any,n),{});const $=[];function o(n,a,d){let r={},s=d.apimsg;for(let u in s){let g=s[u];typeof g=="function"?r[u]=g(n,a,d):r[u]=JSON.parse(JSON.stringify(g))}return r}let f={name:"BrowserStore",save:function(n,a,d){let r=e.debug&&w(arguments),s=e.prepareCtx(n),u=o(n,s,e);r&&v(r,s,u),this.act(u,function(p,_,b){return r&&y(r,arguments),i.save(this,s,a,p,_,b,r)})},load:function(n,a,d){let r=e.debug&&w(arguments),s=e.prepareCtx(n),u=o(n,s,e);r&&v(r,s,u),this.act(u,function(p,_,b){return r&&y(r,arguments),i.load(this,s,a,p,_,b,r)})},list:function(n,a,d){let r=e.debug&&w(arguments),s=e.prepareCtx(n),u=o(n,s,e);r&&v(r,s,u),this.act(u,function(p,_,b){return r&&y(r,arguments),i.list(this,s,a,p,_,b,r)})},remove:function(n,a,d){let r=e.debug&&w(arguments),s=e.prepareCtx(n),u=o(n,s,e);r&&v(r,s,u),this.act(u,function(p,_,b){return r&&y(r,arguments),i.remove(this,s,a,p,_,b,r)})},close:function(n,a){a()},native:function(n,a){a()}},S=m(t,e,f);function w(n){let a=e.debug&&{msg:n[0],meta:n[2],start:Date.now()};return a&&$.push(a),a}function v(n,a,d){return n.apistart=Date.now(),n.ctx=a,n.apimsg=d,n}function y(n,a){return n.apiend=Date.now(),n.err=a[0],n.res=a[1],n.apimeta=a[2],n}return{name:f.name,tag:S.tag,exports:{makeApiMsg:o,msglog:$}}}function h(e,t){return e.entity(t.zone,t.base,t.name).canon$()}return c.defaults={debug:!1,apimsg:{aim:"req",on:"entity",debounce$:!0,q:(e,t)=>e.q,ent:(e,t)=>e.ent,cmd:(e,t)=>t.cmd,store:(e,t)=>t.store,name:(e,t)=>t.name,base:(e,t)=>t.base,zone:(e,t)=>t.zone},prepareCtx:(e,t)=>{t=t||{};let m=e.q;t.store=m.store$!==!1,delete m.store$,t.cmd=e.cmd;let l=e.ent||e.qent;if(l){if(l.canon$)Object.assign(t,l.canon$({object:!0}));else if(l.entity$){let i=l.entity$.split("/");Object.assign(t,{zone:i[0]==="-"?null:i[0],base:i[1]==="-"?null:i[1],name:i[2]==="-"?null:i[2]})}}return t},handleResponse:{any:function(e,t,m,l,i,$,o){if(o&&(o.end=Date.now()),l)return m(l);if(i&&i.ok)return m(i.ent);{let f=i&&i.err;return f=f||new Error(`BrowserStore: ${t.cmd} ${h(e,t)}: unknown error`),m(f)}},list:function(e,t,m,l,i,$,o){if(o&&(o.end=Date.now()),l&&m(l),i&&i.ok&&i.list){let f=e.entity({zone:t.zone,base:t.base,name:t.name}),S=i.list.map(w=>f.make$().data$(w));o&&(o.end=Date.now()),m(S)}else{let f=i&&i.err;f=f||new Error(`BrowserStore: ${t.cmd} ${h(e,t)}: unknown list error`),m(f)}}}},Object.defineProperty(c,"name",{value:"BrowserStore"}),c});
//# sourceMappingURL=browser-store.umd.js.map
