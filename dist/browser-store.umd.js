(function(c,b){typeof exports=="object"&&typeof module<"u"?module.exports=b():typeof define=="function"&&define.amd?define(b):(c=typeof globalThis<"u"?globalThis:c||self,c.BrowserStore=b())})(this,function(){"use strict";function c(t){let e=this,m=e.export("entity/init"),o=t.handleResponse,i=["save","load","list","remove"].reduce((n,a)=>(n[a]=o[a]||o.any,n),{});const w=[];function l(n,a,f){let r={},s=f.apimsg;for(let u in s){let g=s[u];typeof g=="function"?r[u]=g(n,a,f):r[u]=JSON.parse(JSON.stringify(g))}return r}let d={name:"BrowserStore",save:function(n,a,f){let r=t.debug&&h(arguments),s=t.prepareCtx(n),u=l(n,s,t);r&&$(r,s,u),this.act(u,function(p,_,v){return r&&y(r,arguments),i.save(this,s,a,p,_,v,r)})},load:function(n,a,f){let r=t.debug&&h(arguments),s=t.prepareCtx(n),u=l(n,s,t);r&&$(r,s,u),this.act(u,function(p,_,v){return r&&y(r,arguments),i.load(this,s,a,p,_,v,r)})},list:function(n,a,f){let r=t.debug&&h(arguments),s=t.prepareCtx(n),u=l(n,s,t);r&&$(r,s,u),this.act(u,function(p,_,v){return r&&y(r,arguments),i.list(this,s,a,p,_,v,r)})},remove:function(n,a,f){let r=t.debug&&h(arguments),s=t.prepareCtx(n),u=l(n,s,t);r&&$(r,s,u),this.act(u,function(p,_,v){return r&&y(r,arguments),i.remove(this,s,a,p,_,v,r)})},close:function(n,a){a()},native:function(n,a){a()}},S=m(e,t,d);function h(n){let a=t.debug&&{msg:n[0],meta:n[2],start:Date.now()};return a&&w.push(a),a}function $(n,a,f){return n.apistart=Date.now(),n.ctx=a,n.apimsg=f,n}function y(n,a){return n.apiend=Date.now(),n.err=a[0],n.res=a[1],n.apimeta=a[2],n}return{name:d.name,tag:S.tag,exports:{makeApiMsg:l,msglog:w}}}function b(t,e){return t.entity(e.zone,e.base,e.name).canon$()}return c.defaults={debug:!1,apimsg:{aim:"req",on:"entity",debounce$:!0,q:(t,e)=>t.q,ent:(t,e)=>t.ent,save:(t,e)=>e.cmd==="save"?"entity":void 0,load:(t,e)=>e.cmd==="load"?"entity":void 0,list:(t,e)=>e.cmd==="list"?"entity":void 0,remove:(t,e)=>e.cmd==="remove"?"entity":void 0,store:(t,e)=>e.store,name:(t,e)=>e.name,base:(t,e)=>e.base,zone:(t,e)=>e.zone},prepareCtx:(t,e)=>{e=e||{};let m=t.q;e.store=m.store$!==!1,delete m.store$,e.cmd=t.cmd;let o=t.ent||t.qent;if(o){if(o.canon$)Object.assign(e,o.canon$({object:!0}));else if(o.entity$){let i=o.entity$.split("/");Object.assign(e,{zone:i[0]==="-"?null:i[0],base:i[1]==="-"?null:i[1],name:i[2]==="-"?null:i[2]})}}return e},handleResponse:{any:function(t,e,m,o,i,w,l){if(l&&(l.end=Date.now()),o)return m(o);if(i&&i.ok)return m(i.ent);{let d=i&&i.err;return d=d||new Error(`BrowserStore: ${e.cmd} ${b(t,e)}: unknown error`),m(d)}},list:function(t,e,m,o,i,w,l){if(l&&(l.end=Date.now()),o&&m(o),i&&i.ok&&i.list){let d=t.entity({zone:e.zone,base:e.base,name:e.name}),S=i.list.map(h=>d.make$().data$(h));l&&(l.end=Date.now()),m(S)}else{let d=i&&i.err;d=d||new Error(`BrowserStore: ${e.cmd} ${b(t,e)}: unknown list error`),m(d)}}}},Object.defineProperty(c,"name",{value:"BrowserStore"}),c});
//# sourceMappingURL=browser-store.umd.js.map
