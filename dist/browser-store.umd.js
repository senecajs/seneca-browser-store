(function(g,e){typeof exports=="object"&&typeof module<"u"?module.exports=e():typeof define=="function"&&define.amd?define(e):(g=typeof globalThis<"u"?globalThis:g||self,g.BrowserStore=e())})(this,function(){"use strict";function g(e){let a=this,l=a.export("entity/init"),m=e.handleResponse,s=["save","load","list","remove"].reduce((n,r)=>(n[r]=m[r]||m.any,n),{});const w=[];function o(n,r,h){let t={},i=h.apimsg;for(let u in i){let _=i[u];typeof _=="function"?t[u]=_(n,r,h):t[u]=JSON.parse(JSON.stringify(_))}return t}let c={name:"BrowserStore",save:function(n,r,h){let t=e.debug&&x(arguments),i=e.prepareCtx(n),u=o(n,i,e);t&&(t.ctx=i)&&(t.apimsg=u),this.act(u,function(f,d,p){return t&&(t.apiend=Date.now())&&(t.err=f)&&(t.res=d)&&(t.apimeta=p),s.save(this,i,r,f,d,p,t)})},load:function(n,r,h){let t=e.debug&&x(arguments),i=e.prepareCtx(n),u=o(n,i,e);t&&(t.ctx=i)&&(t.apimsg=u),this.act(u,function(f,d,p){return t&&S(t,arguments),s.load(this,i,r,f,d,p,t)})},list:function(n,r,h){let t=e.debug&&x(arguments),i=e.prepareCtx(n),u=o(n,i,e);t&&(t.ctx=i)&&(t.apimsg=u),this.act(u,function(f,d,p){return t&&S(t,arguments),s.list(this,i,r,f,d,p,t)})},remove:function(n,r,h){let t=e.debug&&x(arguments),i=e.prepareCtx(n),u=o(n,i,e);t&&(t.ctx=i)&&(t.apimsg=u),this.act(u,function(f,d,p){return t&&S(t,arguments),s.remove(this,i,r,f,d,p,t)})},close:function(n,r){r()},native:function(n,r){r()}},v=l(a,e,c);function x(n){let r=e.debug&&{msg:n[0],meta:n[2],start:Date.now()};return r&&w.push(r),r}function S(n,r){return n.apiend=Date.now(),n.err=r[0],n.res=r[1],n.apimeta=r[2],n}return{name:c.name,tag:v.tag,exports:{makeApiMsg:o,msglog:w}}}return g.defaults={debug:!1,apimsg:{aim:"req",on:"entity",debounce$:!0,q:(e,a)=>e.q,ent:(e,a)=>e.ent,cmd:(e,a)=>a.cmd,canon:(e,a)=>(e.ent||e.qent).entity$,store:(e,a)=>a.store},prepareCtx:(e,a)=>{a=a||{};let l=e.q;return a.store=l.store$!==!1,delete l.store$,a.cmd=e.cmd,a.canon=(e.ent||e.qent).entity$,a},handleResponse:{any:function(e,a,l,m,s,w,o){if(console.log("BS RES",m,s),o&&(o.end=Date.now()),m&&l(m),s)if(s.ok)l(s.ent);else{let c=s.err;c=c||new Error(`BrowserStore: ${a.cmd} ${a.canon}: unknown error`),l(c)}},list:function(e,a,l,m,s,w,o){if(o&&(o.end=Date.now()),m&&l(m),s&&s.ok&&s.list){let c=s.list.map(v=>e.entity(a.canon).data$(v));o&&(o.end=Date.now()),l(c)}else l(s&&s.err||new Error(`BrowserStore: ${a.cmd} ${a.canon}: unknown list error`))}}},Object.defineProperty(g,"name",{value:"BrowserStore"}),g});
//# sourceMappingURL=browser-store.umd.js.map
