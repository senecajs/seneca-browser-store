(function(c,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(c=typeof globalThis<"u"?globalThis:c||self,c.BrowserStore=h())})(this,function(){"use strict";function c(t){let e=this,o=e.export("entity/init"),l=t.handleResponse,a=["save","load","list","remove"].reduce((n,i)=>(n[i]=l[i]||l.any,n),{});const y=[];function g(n,i,f){let r={},u=f.apimsg;for(let s in u){let p=u[s];typeof p=="function"?r[s]=p(n,i,f):r[s]=JSON.parse(JSON.stringify(p))}return r}let d={name:"BrowserStore",save:function(n,i,f){let r=t.debug&&w(arguments),u=t.prepareCtx(n),s=g(n,u,t);r&&$(r,u,s),this.act(s,function(_,b,v){return r&&S(r,arguments),a.save(this,u,i,_,b,s,v,r)})},load:function(n,i,f){let r=t.debug&&w(arguments),u=t.prepareCtx(n),s=g(n,u,t);r&&$(r,u,s),this.act(s,function(_,b,v){return r&&S(r,arguments),a.load(this,u,i,_,b,s,v,r)})},list:function(n,i,f){let r=t.debug&&w(arguments),u=t.prepareCtx(n),s=g(n,u,t);r&&$(r,u,s),this.act(s,function(_,b,v){return r&&S(r,arguments),a.list(this,u,i,_,b,s,v,r)})},remove:function(n,i,f){let r=t.debug&&w(arguments),u=t.prepareCtx(n),s=g(n,u,t);r&&$(r,u,s),this.act(s,function(_,b,v){return r&&S(r,arguments),a.remove(this,u,i,_,b,s,v,r)})},close:function(n,i){i()},native:function(n,i){i()}},m=o(e,t,d);function w(n){let i=t.debug&&{msg:n[0],meta:n[2],start:Date.now()};return i&&y.push(i),i}function $(n,i,f){return n.apistart=Date.now(),n.ctx=i,n.apimsg=f,n}function S(n,i){return n.apiend=Date.now(),n.err=i[0],n.res=i[1],n.apimeta=i[2],n}return{name:d.name,tag:m.tag,exports:{makeApiMsg:g,msglog:y}}}function h(t,e){return t.entity(e.zone,e.base,e.name).canon$()}return c.defaults={debug:!1,apimsg:{aim:"req",on:"entity",debounce$:!0,q:(t,e)=>t.q,ent:(t,e)=>t.ent,save:(t,e)=>e.cmd==="save"?"entity":void 0,load:(t,e)=>e.cmd==="load"?"entity":void 0,list:(t,e)=>e.cmd==="list"?"entity":void 0,remove:(t,e)=>e.cmd==="remove"?"entity":void 0,store:(t,e)=>e.store,name:(t,e)=>e.name,base:(t,e)=>e.base,zone:(t,e)=>e.zone},prepareCtx:(t,e)=>{e=e||{};let o=t.q;e.store=o.store$!==!1,delete o.store$,e.cmd=t.cmd;let l=t.ent||t.qent;if(l){if(l.canon$)Object.assign(e,l.canon$({object:!0}));else if(l.entity$){let a=l.entity$.split("/");Object.assign(e,{zone:a[0]==="-"?null:a[0],base:a[1]==="-"?null:a[1],name:a[2]==="-"?null:a[2]})}}return e},handleResponse:{any:function(t,e,o,l,a,y,g,d){if(d&&(d.end=Date.now()),l)return o(l);if(y.load==="entity"&&(a==null||a.ok==null))return o(null);if(a&&a.ok&&a.item){let m=t.entity({zone:e.zone,base:e.base,name:e.name});return o(m.make$().data$(a.item))}else{let m=a&&a.err;return m=m||new Error(`BrowserStore: ${e.cmd} ${h(t,e)}: unknown error`),o(m)}},list:function(t,e,o,l,a,y,g,d){if(d&&(d.end=Date.now()),l&&o(l),a&&a.ok&&a.list){let m=t.entity({zone:e.zone,base:e.base,name:e.name}),w=a.list.map($=>m.make$().data$($));d&&(d.end=Date.now()),o(w)}else{let m=a&&a.err;m=m||new Error(`BrowserStore: ${e.cmd} ${h(t,e)}: unknown list error`),o(m)}}}},Object.defineProperty(c,"name",{value:"BrowserStore"}),c});
//# sourceMappingURL=browser-store.umd.js.map
