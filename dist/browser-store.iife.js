var BrowserStore=function(){"use strict";function $(t){let e=this,o=e.export("entity/init"),l=t.handleResponse,i=["save","load","list","remove"].reduce((n,a)=>(n[a]=l[a]||l.any,n),{});const b=[];function m(n,a,d){let r={},s=d.apimsg;for(let u in s){let f=s[u];typeof f=="function"?r[u]=f(n,a,d):r[u]=JSON.parse(JSON.stringify(f))}return r}let c={name:"BrowserStore",save:function(n,a,d){let r=t.debug&&v(arguments),s=t.prepareCtx(n),u=m(n,s,t);r&&w(r,s,u),this.act(u,function(g,_,p){return r&&h(r,arguments),i.save(this,s,a,g,_,p,r)})},load:function(n,a,d){let r=t.debug&&v(arguments),s=t.prepareCtx(n),u=m(n,s,t);r&&w(r,s,u),this.act(u,function(g,_,p){return r&&h(r,arguments),i.load(this,s,a,g,_,p,r)})},list:function(n,a,d){let r=t.debug&&v(arguments),s=t.prepareCtx(n),u=m(n,s,t);r&&w(r,s,u),this.act(u,function(g,_,p){return r&&h(r,arguments),i.list(this,s,a,g,_,p,r)})},remove:function(n,a,d){let r=t.debug&&v(arguments),s=t.prepareCtx(n),u=m(n,s,t);r&&w(r,s,u),this.act(u,function(g,_,p){return r&&h(r,arguments),i.remove(this,s,a,g,_,p,r)})},close:function(n,a){a()},native:function(n,a){a()}},y=o(e,t,c);function v(n){let a=t.debug&&{msg:n[0],meta:n[2],start:Date.now()};return a&&b.push(a),a}function w(n,a,d){return n.apistart=Date.now(),n.ctx=a,n.apimsg=d,n}function h(n,a){return n.apiend=Date.now(),n.err=a[0],n.res=a[1],n.apimeta=a[2],n}return{name:c.name,tag:y.tag,exports:{makeApiMsg:m,msglog:b}}}function S(t,e){return t.entity(e.zone,e.base,e.name).canon$()}return $.defaults={debug:!1,apimsg:{aim:"req",on:"entity",debounce$:!0,q:(t,e)=>t.q,ent:(t,e)=>t.ent,save:(t,e)=>e.cmd==="save"?"entity":void 0,load:(t,e)=>e.cmd==="load"?"entity":void 0,list:(t,e)=>e.cmd==="list"?"entity":void 0,remove:(t,e)=>e.cmd==="remove"?"entity":void 0,store:(t,e)=>e.store,name:(t,e)=>e.name,base:(t,e)=>e.base,zone:(t,e)=>e.zone},prepareCtx:(t,e)=>{e=e||{};let o=t.q;e.store=o.store$!==!1,delete o.store$,e.cmd=t.cmd;let l=t.ent||t.qent;if(l){if(l.canon$)Object.assign(e,l.canon$({object:!0}));else if(l.entity$){let i=l.entity$.split("/");Object.assign(e,{zone:i[0]==="-"?null:i[0],base:i[1]==="-"?null:i[1],name:i[2]==="-"?null:i[2]})}}return e},handleResponse:{any:function(t,e,o,l,i,b,m){if(m&&(m.end=Date.now()),l)return o(l);if(i&&i.ok)return o(i.ent);{let c=i&&i.err;return c=c||new Error(`BrowserStore: ${e.cmd} ${S(t,e)}: unknown error`),o(c)}},list:function(t,e,o,l,i,b,m){if(m&&(m.end=Date.now()),l&&o(l),i&&i.ok&&i.list){let c=t.entity({zone:e.zone,base:e.base,name:e.name}),y=i.list.map(v=>c.make$().data$(v));m&&(m.end=Date.now()),o(y)}else{let c=i&&i.err;c=c||new Error(`BrowserStore: ${e.cmd} ${S(t,e)}: unknown list error`),o(c)}}}},Object.defineProperty($,"name",{value:"BrowserStore"}),$}();
//# sourceMappingURL=browser-store.iife.js.map
